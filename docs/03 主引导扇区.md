# 主引导扇区

## 程序载入内存的含义

1. 加载器加载程序到内存某个区域；
2. 设置 CPU 的 `cs:ip` 指向该程序的起始地址。

## BIOS (Basic Input Output System)

### 地址映射

1. 内存地址 `0~0x9FFFF`: 640KiB  ==>  `DRAM` (动态随机访问内存)
2. 内存地址 `0xF0000~0xFFFFF`: 64KiB  ==>  `ROM` (BOIS 代码)

![实模式下的内存布局](../docs/images/%E5%AE%9E%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.jpg)

### BOIS 的功能

- 检测、初始化硬件；
- 建立**中断向量表**: `int` 中断号 - 实现对硬件的基本 IO 操作

#### 0x7c00

BIOS 最后一项工作是校验启动盘中位于 0 盘 0 道 1 扇区的内容，若该扇区末尾两字节为 `0x55` 和 `0xaa`，加载其可执行程序 (**主引导程序 MBR** - 内核加载器) 到物理地址 `0x7c00`，并跳转至此处执行。


## 实模式

- Read Mode: 8086 模式，16-bit

### 实模式的寻址方式

有效地址 = 段地址 * 16 + 偏移地址

> EA (Effective Address) = 0xb800 << 4 + 0 = 0xb8000

## 主引导扇区的结构

- 代码: 446B
- 硬盘分区表: 64B = 4 * 16B
- 魔数: 0xaa55 (0x55 0xaa)